function log(e){console.error(e)}function checkSupportBrowser(){if(_getUserMedia||(log("unsupported browser"),$("#support-browser-notify").show(),$("#btnScreenShare").prop("disabled",!0)),detectmob()){var e='<div class="waiting-spinner">';e+='<div class="cube1"></div>',e+='<div class="cube2"></div>',e+="</div>",e+='<div style="font-size:16px; font-weight:strong;">화면공유 대기중...</div>',$("#selectScreenLayer").html(e)}}function initXirsys(){$.ajax({url:"https://service.xirsys.com/ice",data:{ident:"rudaks",secret:"3bff0ec0-ff6e-11e5-bd77-af395686a329",domain:"node.spectra.co.kr",application:"default",room:"node",secure:1},success:function(e,n){peerConnectionConfig=e.d,initWebRTC(peerConnectionConfig)}})}function initialize(){$("#btnCloseScreenShare").on("click",function(){webrtc.getLocalScreen()&&webrtc.stopScreenShare()}),$("#btnScreenShare").on("click",function(){webrtc.getLocalScreen()?webrtc.stopScreenShare():webrtc.shareScreen(function(e){})});var e=new ZeroClipboard(document.getElementById("btnCopyUrl"));e.on("ready",function(n){$("#btnCopyUrl").attr("data-clipboard-text",location.href),e.on("aftercopy",function(e){$.notify({message:"클립보드에 복사하였습니다. Ctrl + V로 붙여넣으세요."},{type:"danger"})})})}function initWebRTC(e){webrtc=new SimpleWebRTC({localVideoEl:"localVideo",remoteVideosEl:"removeVideo",autoRequestMedia:!0,debug:!1,detectSpeakingEvents:!1,autoAdjustMic:!1,media:{video:!1,audio:!1},peerConnectionConfig:e}),webrtc.on("readyToCall",function(){console.log("readyToCall"),room&&(console.log("room : "+room),webrtc.joinRoom(room))}),webrtc.on("videoAdded",function(e,n){console.log("_____video added peer : ",n),$("#loadingTextLayer").show(),startScreenSharing(e),$("#btnCloseScreenShare").hide(),addParticipants(room)}),webrtc.on("videoRemoved",function(e,n){console.log("video removed",n),console.log("video added peer : ",n),stopScreenSharing(),addParticipants(room),n&&$.notify("화면공유가 종료되었습니다.",{animate:{enter:"animated rollIn",exit:"animated rollOut"},type:"danger"})}),webrtc.on("localScreenAdded",function(e){log("localScreenAdded"),startScreenSharing(e),$("#copyUrlSpan").show(),$.notify({message:"URL을 공유할 사용자에게 전달하세요."},{type:"warning",placement:{from:"bottom",align:"right"}})}),webrtc.on("localScreenRemoved",function(e){log("localScreenRemoved")}),webrtc.on("localScreenStopped",function(){log("localScreenStopped"),stopScreenSharing(),$("#copyUrlSpan").hide()})}function startScreenSharing(e){document.getElementById("localScreenContainer").appendChild(e);var n=$("#localScreenContainer").find("video");n.css({width:"80%",border:"1px solid #333",transform:"rotate(360deg)"}),n.attr("autoplay","true"),n.attr("controls","true"),n.on("dblclick",resizeToFullScreen),$("#localScreenLayer").show(),$("#loadingTextLayer").hide(),$("#btnScreenShare").prop("disabled",!0),$("#selectScreenLayer").css({display:"none"})}function stopScreenSharing(){$("#localScreenLayer").find("video").remove(),$("#localScreenLayer").hide(),$("#btnScreenShare").prop("disabled",!1),$("#selectScreenLayer").css({display:"block"})}function addParticipants(e){var n=new Firebase("https://screen-share-fe249.firebaseio.com/screenshare/room-"+e);n.authWithCustomToken(FIREBASE_AUTH,function(e,o){e?console.log("Authentication Failed!",e):n.on("value",onValueFirebase,function(e){console.log("The read failed: "+e.code)})})}function onValueFirebase(e){var n=0;e.forEach(function(e){e.key(),e.val();n++});var o=0;o=n-1,console.error("___________onValueFirebase"),console.error("displayCount : "+o);var r=$("#paticipantsLayer").find(".badge");o>=1?(r.text(o),$("#paticipantsLayer").show()):$("#paticipantsLayer").hide()}function onResizeWindow(){resizeRemoteVideoScreen()}function resizeToFullScreen(){var e=$("#localScreenContainer").find("video"),n=e.get(0);n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()}function updateToFirebase(e){var n=Math.floor(1e8*Math.random()),o=new Firebase("https://screen-share-fe249.firebaseio.com/screenshare/room-"+e),r="user-"+n;o.authWithCustomToken(FIREBASE_AUTH,function(n,t){if(n)console.log("Authentication Failed!",n);else{if(atob){var a=r,i=o.parent().parent().child("/screenshare/room-"+e+"/"+a),c={user:r,ip:ipAddress,username:username,created:getCurrDate()};i.update(c),i.onDisconnect().remove();var s=r,l=decodeURIComponent(location.href),d={};c.url=l,d[s]=c,o.update(d);var a=r,u=getCurrDate("date"),i=o.parent().parent().child("/screenshare-access-log/"+u+"/room-"+e+"/"+a),c={user:r,ip:ipAddress,username:username,created:getCurrDate()};i.update(c)}o.on("value",onValueFirebase,function(e){console.log("The read failed: "+e.code)})}})}function getCurrDate(e){var n=new Date,o=n.getFullYear(),r=n.getMonth()+1,t=n.getDate(),a=n.getHours(),i=n.getMinutes(),c=n.getSeconds();if(1==r.toString().length)var r="0"+r;if(1==t.toString().length)var t="0"+t;if(1==a.toString().length)var a="0"+a;if(1==i.toString().length)var i="0"+i;if(1==c.toString().length)var c="0"+c;return"date"==e?o+"-"+r+"-"+t:"time"==e?a+":"+i+":"+c:o+"-"+r+"-"+t+"@"+a+":"+i+":"+c}function getCookie(e){e+="=";var n=document.cookie,o=n.indexOf(e),r="";if(o!=-1){o+=e.length;var t=n.indexOf(";",o);t==-1&&(t=n.length),r=n.substring(o,t)}return r}function detectmob(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}var FIREBASE_AUTH="R13DqMrp6nU8E99jlwDdQzlDGlK3rDXmJCMkqncO",_getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;