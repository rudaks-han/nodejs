function initialize(){var e,t=new ZeroClipboard(document.getElementById("btnInvite"));t.on("ready",function(o){$("#btnInvite").attr("data-clipboard-text",location.href),clearTimeout(e),t.on("aftercopy",function(t){$("#btnInvite").find(".button-label").text("복사되었습니다"),$.notify({message:"클립보드에 복사하였습니다. Ctrl + V로 붙여넣으세요."},{type:"danger"}),e=setTimeout(function(){$("#btnInvite").find(".button-label").text("초대")},3e3)}),$(window).on("resize",onResizeWindow)}),$("#btnCloseScreenShare").on("click",function(){webrtc.getLocalScreen()&&webrtc.stopScreenShare()}),$("#toggleAudio").on("click",function(){$(this).hasClass("mute")?(webrtc.unmute(),$(this).removeClass("mute"),$(this).find("img").attr("src","/images/mic.png")):(webrtc.mute(),$(this).addClass("mute"),$(this).find("img").attr("src","/images/mic_off.png"))}),$("#toggleVideo").on("click",function(){$(this).hasClass("blind")?(webrtc.resumeVideo(),$(this).removeClass("blind"),$(this).find("img").attr("src","/images/video.png")):(webrtc.pauseVideo(),$(this).addClass("blind"),$(this).find("img").attr("src","/images/video_off.png"))}),$("#btnScreenShare").on("click",function(){webrtc.getLocalScreen()?webrtc.stopScreenShare():webrtc.shareScreen(function(e){})})}function initXirsys(){$.ajax({url:"https://service.xirsys.com/ice",data:{ident:"rudaks",secret:"3bff0ec0-ff6e-11e5-bd77-af395686a329",domain:"node.spectra.co.kr",application:"default",room:"node",secure:1},success:function(e,t){log("ajax result : "+JSON.stringify(e)),peerConnectionConfig=e.d,initWebRTC(peerConnectionConfig)}})}function initWebRTC(e){webrtc=new SimpleWebRTC({localVideoEl:"localVideo",remoteVideosEl:"remoteVideo",autoRequestMedia:!0,debug:!1,detectSpeakingEvents:!0,autoAdjustMic:!1,peerConnectionConfig:e}),webrtc.on("readyToCall",function(){room&&webrtc.joinRoom(room)}),webrtc.on("channelMessage",function(e,t,o){log("channelMessage"),"volume"==o.type&&showVolume(document.getElementById("volume_"+e.id),o.volume)}),webrtc.on("videoAdded",function(e,t){console.log("video added",t),setRemoteBackground(!0);var o="container_"+webrtc.getDomId(t),i=$("<div />").attr("class","video-stream").attr("id",o).append(e);$("#remotesPanel").append(i);var n=i.find("video");n.addClass("screenshare"),n.addClass("fit-width"),n.on("dblclick",resizeToFullScreen),resizeRemoteVideoScreen();var r=$('<video class="video-paticipants"></video>'),a=$("<div />").attr("class","remote-paticipants").attr("id",o+"_paticipants").append(r);$("#remotePaticipantsLayer").append(a),$("#"+o+"_paticipants").find("video").attr("src",URL.createObjectURL(t.stream));var c='<div class="ck-layer">';c+='<input type="checkbox" id="'+o+'_ck" video-source="'+o+'" checked />',c+="</div>",$(c).appendTo("#"+o+"_paticipants"),$("#"+o+"_ck").on("click",function(){var e=$(this).attr("video-source");$(this).prop("checked")?$("#"+e).show():$("#"+e).hide(),resizeRemoteVideoScreen()})}),webrtc.on("videoRemoved",function(e,t){if(log("videoRemoved"),t){var o="container_"+webrtc.getDomId(t);$("#remotesPanel").find("#"+o).remove(),$("#remotePaticipantsLayer").find("#"+o+"_paticipants").remove()}0==$("#remotesPanel").find(".video-stream").length&&setRemoteBackground(!1),resizeRemoteVideoScreen()}),webrtc.on("volumeChange",function(e,t){showVolume(document.getElementById("localVolume"),e)}),webrtc.on("localScreenAdded",function(e){log("localScreenAdded"),document.getElementById("localScreenContainer").appendChild(e),$("#localScreenContainer").find("video").css({width:"200px"}),$("#localScreenLayer").show()}),webrtc.on("localScreenRemoved",function(e){log("localScreenRemoved"),document.getElementById("localScreenContainer").removeChild(e),$("#localScreenLayer").hide()}),webrtc.on("mute",function(e){log("mute"),webrtc.getPeers(e.id).forEach(function(t){"audio"==e.name?$("#videocontainer_"+webrtc.getDomId(t)+" .muted").show():"video"==e.name&&($("#videocontainer_"+webrtc.getDomId(t)+" .paused").show(),$("#videocontainer_"+webrtc.getDomId(t)+" video").hide())})}),webrtc.on("unmute",function(e){log("unmute"),webrtc.getPeers(e.id).forEach(function(t){"audio"==e.name?$("#videocontainer_"+webrtc.getDomId(t)+" .muted").hide():"video"==e.name&&($("#videocontainer_"+webrtc.getDomId(t)+" video").show(),$("#videocontainer_"+webrtc.getDomId(t)+" .paused").hide())})}),webrtc.on("audioOn",function(){log("audioOn")}),webrtc.on("audioOff",function(){log("audioOff")}),webrtc.on("videoOn",function(){log("videoOn")}),webrtc.on("videoOff",function(){log("videoOff")}),webrtc.on("localScreenStopped",function(){log("localScreenStopped"),$("#localScreenLayer").find("video").remove(),$("#localScreenLayer").hide()})}function resizeRemoteVideoScreen(){setTimeout(function(){var e=$(document).width(),t=$("#remotesPanel").find(".video-stream:visible"),o=t.length;switch(t.css({position:"absolute",left:"0",top:"0",width:"100%",height:"100%"}),o){case 2:e<=492?(t.eq(0).css({width:"100%",height:"50%",left:"0",top:"0"}),t.eq(1).css({width:"100%",height:"50%",left:"0",top:"50%"}),t.find("video").removeClass("fit-height").addClass("fit-width")):(t.eq(0).css({left:"0",top:"0%",width:"50%",height:"100%"}),t.eq(1).css({left:"50%",top:"0%",width:"50%",height:"100%"}),t.find("video").removeClass("fit-width").addClass("fit-height"));break;case 3:case 4:t.find("video").removeClass("fit-width").addClass("fit-height"),t.eq(0).css({width:"50%",height:"50%",left:"0",top:"0"}),t.eq(1).css({width:"50%",height:"50%",left:"50%",top:"0"}),t.eq(2).css({width:"50%",height:"50%",left:"0",top:"50%"}),t.eq(3).css({width:"50%",height:"50%",left:"50%",top:"50%"});break;case 5:case 6:t.find("video").removeClass("fit-width").addClass("fit-height"),t.eq(0).css({width:"33.3333%",height:"50%",left:"0",top:"0"}),t.eq(1).css({width:"33.3333%",height:"50%",left:"33.3333%",top:"0"}),t.eq(2).css({width:"33.3333%",height:"50%",left:"66.6667%",top:"0"}),t.eq(3).css({width:"33.3333%",height:"50%",left:"0",top:"50%"}),t.eq(4).css({width:"33.3333%",height:"50%",left:"33.3333%",top:"50%"}),t.eq(5).css({width:"33.3333%",height:"50%",left:"66.6667%",top:"50%"})}},500)}function setRoom(e){$("form").remove(),$("h1").text(e),$("#join-url-link").text(location.href),$("body").addClass("active")}function showVolume(e,t){e&&(t<-45?e.style.height="0px":t>-20?e.style.height="100%":e.style.height=""+Math.floor(100*(t+100)/25-220)+"%")}function setRemoteBackground(e){e?($(".stream-podium").css({background:"#4d5659"}),$(".join-text-layer").hide()):($(".stream-podium").css({background:"#fff"}),$(".join-text-layer").show())}function onResizeWindow(){resizeRemoteVideoScreen()}function checkSupportBrowser(){_getUserMedia?/KAKAOTALK/i.test(navigator.userAgent)&&($("#support-browser-notify").text("카카오톡에서는 지원하지 않습니다. Chrome을 사용하시기 바랍니다."),$("#support-browser-notify").show()):($("#support-browser-notify").text("지원하지 않는 브라우저 입니다. Chrome을 사용하시기 바랍니다."),$("#support-browser-notify").show())}function resizeToFullScreen(e){var t=e.target;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}function updateToFirebase(e){var t=Math.floor(1e8*Math.random()),o=new Firebase("https://screen-share-fe249.firebaseio.com/screenshare/room-"+e),i="user-"+t;o.authWithCustomToken(FIREBASE_AUTH,function(t,n){if(t)console.log("Authentication Failed!",t);else{if(atob){var r=i,a=o.parent().parent().child("/video/room-"+e+"/"+r),c={user:i,ip:ipAddress,username:username,created:getCurrDate()};a.update(c),a.onDisconnect().remove();var s=i,d=decodeURIComponent(location.href),l={};c.url=d,l[s]=c,o.update(l);var r=i,u=getCurrDate("date"),a=o.parent().parent().child("/video-access-log/"+u+"/room-"+e+"/"+r),c={user:i,ip:ipAddress,username:username,created:getCurrDate()};if("211.63.24.124"==ipAddress)return;a.update(c)}o.on("value",onValueFirebase,function(e){console.log("The read failed: "+e.code)})}})}function onValueFirebase(e){var t=0;e.forEach(function(e){e.key(),e.val();t++});var o=0;o=t-1;var i=$("#paticipantsLayer").find(".badge");o>=1?(i.text(o),$("#paticipantsLayer").show()):$("#paticipantsLayer").hide()}function getCurrDate(e){var t=new Date,o=t.getFullYear(),i=t.getMonth()+1,n=t.getDate(),r=t.getHours(),a=t.getMinutes(),c=t.getSeconds();if(1==i.toString().length)var i="0"+i;if(1==n.toString().length)var n="0"+n;if(1==r.toString().length)var r="0"+r;if(1==a.toString().length)var a="0"+a;if(1==c.toString().length)var c="0"+c;return"date"==e?o+"-"+i+"-"+n:"time"==e?r+":"+a+":"+c:o+"-"+i+"-"+n+"@"+r+":"+a+":"+c}function getCookie(e){e+="=";var t=document.cookie,o=t.indexOf(e),i="";if(o!=-1){o+=e.length;var n=t.indexOf(";",o);n==-1&&(n=t.length),i=t.substring(o,n)}return i}function detectmob(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}function log(e){_debug&&console.error(e)}var _getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia,FIREBASE_AUTH="R13DqMrp6nU8E99jlwDdQzlDGlK3rDXmJCMkqncO",_debug=!1;